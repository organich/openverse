import{T as q}from"./DEfBnNKa.js";import{P as K,L as $,a as D,R as Q,u as V,n as z}from"./BDR3Ouqq.js";import{g as w,_ as P,w as W,t as Z,d as G,s as J,c as U}from"./kOSZFU2l.js";import{d as O,Z as X,as as Y,h as k,A,$ as H,T as L,au as ee,p as te,F as ae,N as _,ag as re,M as b,D as N,O as ne,L as oe,I as T}from"./D36rSpla.js";import{u as M,b as I,c as se}from"./C6A5PBPG.js";import{u as ie,a as ue,i as E,b as le,c as ce,h as de}from"./BADMhBhM.js";import{u as fe}from"./Cy62xZ0a.js";import{u as me}from"./DkO16Mqk.js";import{s as F}from"./4MnmF0OT.js";import{s as pe}from"./BOX21o1p.js";import{u as he}from"./CpXWnaV6.js";import{A as ve}from"./Cgdi_O8X.js";import{_ as ge}from"./BdgSZSiN.js";import{w as ye}from"./DCwVccl7.js";import"./CFMQYC2y.js";import"./BTng7GyL.js";import"./yH-X360_.js";import"./CVtkxrq9.js";import"./CNEBUHZX.js";import"../sb-preview/runtime.js";import"./Xs_VBmP5.js";import"./Bz7P8nyL.js";import"./DmX7z5YB.js";import"./BUOwoxew.js";import"./BSEdKPgk.js";import"./CXqaUaDA.js";import"./BG4T5isn.js";import"./CTON8dBl.js";import"./BZI5Q7ZN.js";import"./Cpj98o6Y.js";import"./Dt-H8hG_.js";import"./Ci7G4jyV.js";import"./D0ww02ZN.js";const _e=O({props:{vnode:{type:Object,required:!0},route:{type:Object,required:!0},vnodeRef:Object,renderKey:String,trackRootNodes:Boolean},setup(e){const n=e.renderKey,a=e.route,c={};for(const r in e.route)Object.defineProperty(c,r,{get:()=>n===e.renderKey?e.route[r]:a[r]});return X(K,Y(c)),()=>k(e.vnode,{ref:e.vnodeRef})}}),ke=O({name:"NuxtPage",inheritAttrs:!1,props:{name:{type:String},transition:{type:[Boolean,Object],default:void 0},keepalive:{type:[Boolean,Object],default:void 0},route:{type:Object},pageKey:{type:[Function,String],default:null}},setup(e,{attrs:n,slots:a,expose:c}){const r=M(),o=A(),l=H(K,null);let m;c({pageRef:o});const i=H($,null);let s;const g=r.deferHydration();if(r.isHydrating){const t=r.hooks.hookOnce("app:error",g);D().beforeEach(t)}return e.pageKey&&L(()=>e.pageKey,(t,p)=>{t!==p&&r.callHook("page:loading:start")}),()=>k(Q,{name:e.name,route:e.route,...n},{default:t=>{const p=Se(l,t.route,t.Component),y=l&&l.matched.length===t.route.matched.length;if(!t.Component){if(s&&!y)return s;g();return}if(s&&i&&!i.isCurrent(t.route))return s;if(p&&l&&(!i||i!=null&&i.isCurrent(l)))return y?s:null;const d=w(t,e.pageKey);!r.isHydrating&&!xe(l,t.route,t.Component)&&m===d&&r.callHook("page:loading:end"),m=d;const h=!!(e.transition??t.route.meta.pageTransition??I),f=h&&Re([e.transition,t.route.meta.pageTransition,I,{onAfterLeave:()=>{r.callHook("page:transition:finish",t.Component)}}].filter(Boolean)),R=e.keepalive??t.route.meta.keepalive??se;return s=P(q,h&&f,W(R,k(ee,{suspensible:!0,onPending:()=>r.callHook("page:start",t.Component),onResolve:()=>{te(()=>r.callHook("page:finish",t.Component).then(()=>r.callHook("page:loading:end")).finally(g))}},{default:()=>{const S=k(_e,{key:d||void 0,vnode:a.default?k(ae,void 0,a.default(t)):t.Component,route:t.route,renderKey:d||void 0,trackRootNodes:h,vnodeRef:o});return R&&(S.type.name=t.Component.type.name||t.Component.type.__name||"RouteProvider"),S}}))).default(),s}})}});function Re(e){const n=e.map(a=>({...a,onAfterLeave:a.onAfterLeave?Z(a.onAfterLeave):void 0}));return G(...n)}function Se(e,n,a){if(!e)return!1;const c=n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)});return!c||c===-1?!1:n.matched.slice(0,c).some((r,o)=>{var l,m,i;return((l=r.components)==null?void 0:l.default)!==((i=(m=e.matched[o])==null?void 0:m.components)==null?void 0:i.default)})||a&&w({route:n,Component:a})!==w({route:e,Component:a})}function xe(e,n,a){return e?n.matched.findIndex(r=>{var o;return((o=r.components)==null?void 0:o.default)===(a==null?void 0:a.type)})<n.matched.length-1:!1}const be=["id"],Te={key:1},ot=O({name:"SearchPage",__name:"search",async setup(e){let n,a;const c=M(),r=he(),o=ie(),l=ue(),m=V(),{searchTerm:i,searchType:s,apiSearchQueryParams:g,searchTypeIsSupported:t}=F(l),{fetchState:p}=F(o),y=A(`${i.value} | Openverse`);L(i,()=>{y.value=`${i.value} | Openverse`}),me(()=>({title:y.value}));const d=A(E(s.value)?{type:s.value,items:s.value===ve?o.allMedia:o.resultItems[s.value]}:null),h=async(u={})=>{if(!E(s.value)||p.value.hasStarted&&f.value!==null&&!ce(f.value))return;u.shouldPersistMedia||(d.value={type:s.value,items:[]});const x=await o.fetchMedia(u);return d.value={type:s.value,items:x},f.value===null||de(f.value)?x:f.value},f=_(()=>p.value.fetchingError),R=_(()=>p.value.isFetching);ye(g,(u,v)=>{le(u,v)||z(l.getSearchPath())},{debounce:800,maxWait:5e3});const S=_(()=>m.query),j=_(()=>m.path),B=_(()=>r.isOn("fetch_sensitive")),C=async()=>{await h({shouldPersistMedia:!0})};return[n,a]=re(async()=>fe("search",async()=>{var v;if(c.isHydrating)return d.value;(v=document.getElementById("main-page"))==null||v.scroll(0,0);const u=await h();return!u||u&&"requestKind"in u?J(u??U("No results found")):u},{server:!1,lazy:!0,watch:[B,S,j]})),await n,a(),(u,v)=>{const x=ke;return b(),N("div",{id:T(pe),tabindex:"-1",class:"browse-page flex w-full flex-col px-6 lg:px-10"},[f.value?(b(),ne(ge,{key:0,"fetching-error":f.value,class:"w-full py-10"},null,8,["fetching-error"])):(b(),N("section",Te,[oe(x,{"page-key":(u._.provides[K]||u.$route).path,results:d.value,"is-fetching":R.value,"search-term":T(i),supported:T(t),"handle-load-more":C,"data-testid":"search-results"},null,8,["page-key","results","is-fetching","search-term","supported"])]))],8,be)}}});export{ot as default};
